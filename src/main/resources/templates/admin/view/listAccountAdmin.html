<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/admin/layout/layout :: content(~{::body},~{::title})}">
<head>
<title>Danh sách tài khoản quản lý đang được sử dụng</title>
</head>
<body>
	<!-- Page Content-->
	<div class="page-content" >
		<div class="container-fluid">
			<!-- Page-Title -->
			<div class="row">
				<div class="col-sm-12">
					<div class="page-title-box">
						<div class="row">
							<div class="col">
								<h4 class="page-title">Danh Sách Tài Khoản Quản Lý Đang Được Sử Dụng</h4>
							</div>
							<!--end col-->
							<div class="col-auto align-self-center">
								<a href="#" class="btn btn-sm btn-outline-primary"
									id="Dash_Date"> <span class="day-name" id="Day_Name">Today:</span>&nbsp;
									<span class="" id="Select_date">Jan 11</span> <i
									data-feather="calendar" class="align-self-center icon-xs ms-1"></i>
								</a> <a href="#" class="btn btn-sm btn-outline-primary"> <i
									data-feather="download" class="align-self-center icon-xs"></i>
								</a>
							</div>
							<!--end col-->
						</div>
						<!--end row-->
					</div>
					<!--end page-title-box-->
				</div>
				<!--end col-->
			</div>
			<!--end row-->
			<!-- end page title end breadcrumb -->
			<div class="row">
				<div class="col-12"  >
					<div class="card" >
						
						<!--end card-header-->
						<div class="card-body">
						
						

  
   <table id="datatable-buttons"
                                class="table table-striped table-bordered dt-responsive nowrap"
                                style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Hình ảnh</th>
                                        <th>Tên Đăng Nhập</th>
                                        <th>Họ Tên</th>
                                        <th>Địa Chỉ</th>
                                        <th>Email</th>
                                        <th>Số Điện Thoại</th>
                                        <th>Ngày Tạo</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="datatable-container">
                                    <!-- Thymeleaf loop to iterate over the list of accounts -->
                                    <tr th:each="taiKhoanAdmin : ${taiKhoanAdminList}">
                                        <td><img th:src="@{'/images/avatar/' +${taiKhoanAdmin.hinhAnh}}" alt="" class="rounded-circle thumb-xs me-1"></td>
                                        <td th:text="${taiKhoanAdmin.tenDangNhap}"></td>
                                        <td th:text="${taiKhoanAdmin.hoTen}"></td>
                                        <td th:text="${taiKhoanAdmin.diaChi}"></td>
                                        <td th:text="${taiKhoanAdmin.email}"></td>
                                        <td th:text="${taiKhoanAdmin.soDienThoai}"></td>
                                        <td th:text="${taiKhoanAdmin.ngayTao}"></td>

                                        <td class="text-right">
                                            <div class="dropdown d-inline-block">
                                                <a class="dropdown-toggle arrow-none" id="dLabel11" data-bs-toggle="dropdown"
                                                    href="#" role="button" aria-haspopup="false" aria-expanded="false">
                                                    <i class="las la-ellipsis-v font-20 text-muted"></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dLabel11">
													<a class="dropdown-item "
														th:href="'/admin/EditedAccount?accountId=' + ${taiKhoanAdmin.tenDangNhap}"
														href="#"> Chỉnh sửa </a>

													<!--                                                     <a class="dropdown-item" href="#">Xóa tài khoản</a> -->
                                                     <a class="dropdown-item lock-account" th:data-account-id="${taiKhoanAdmin.tenDangNhap}" href="#">Khóa tài khoản</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
  
  
  
<!--   <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">...</div> -->
</div>



							
						</div>
					</div>
				</div>
				<!-- end col -->
			</div>
			<!-- end row -->
		</div>
		<!-- container -->
		<footer class="footer text-center text-sm-start">
			&copy;
			<script>
				document.write(new Date().getFullYear())
			</script>
			Dastone <span class="text-muted d-none d-sm-inline-block float-end">Crafted
				with <i class="mdi mdi-heart text-danger"></i> by Mannatthemes
			</span>
		</footer>
		<!--end footer-->
	<!-- end page content -->
	
	
	<div th:each="taiKhoanAdmin : ${taiKhoanAdminList}">
    <div class="modal fade" th:id="'confirmationModal-' + ${taiKhoanAdmin.tenDangNhap}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Xác nhận</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Bạn có chắc chắn muốn khóa tài khoản này?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary confirmLock" th:data-account-id="${taiKhoanAdmin.tenDangNhap}">Yes</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 	<div th:each="taiKhoanAdmin : ${taiKhoanAdminList}"> -->
<!--     <div class="modal fade" th:id="'editAccountModal-' + ${taiKhoanAdmin.tenDangNhap}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"> -->
<!--         <div class="modal-dialog"> -->
<!--             <div class="modal-content"> -->
<!--                 <div class="modal-header"> -->
<!--                     <h5 class="modal-title" id="exampleModalLabel">Chỉnh sửa thông tin tài khoản</h5> -->
<!--                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
<!--                 </div> -->
<!--                 <div class="modal-body"> -->
<!--                     Form to edit user details -->
                    
<!--                         <input type="hidden" id="editAccountId" th:value="${taiKhoanAdmin.tenDangNhap}"> -->
                        
<!--                         <div class="mb-3"> -->
<!--                             <label for="editHinhAnh" class="form-label">Hình ảnh</label><br> -->
<!--                             Existing image display -->
<!--                             <center><img style="width: 300px; height: auto;" th:src="@{'/images/avatar/' + ${taiKhoanAdmin.hinhAnh}}" alt="Existing Image" class="existing-image"></center> -->
<!--                             Input file for image upload -->
<!--                             <input type="file" class="form-control" id="editHinhAnh" accept="image/*"> -->
<!--                         </div> -->

<!-- 							<div class="mb-3"> -->
<!-- 								<label for="editHoTen" class="form-label">Họ Tên</label> <input -->
<!-- 									type="text" class="form-control" id="editHoTen33" -->
<!-- 									th:value="${taiKhoanAdmin.hoTen}"> -->
<!-- 								<div id="errorContainer" class="error-message"></div> -->
<!-- 							</div> -->

<!-- 							<div class="mb-3"> -->
<!-- 								<label for="editDiaChi" class="form-label">Địa Chỉ</label> <input -->
<!-- 									type="text" class="form-control" id="editDiaChi" -->
<!-- 									th:value="${taiKhoanAdmin.diaChi}"> -->
<!-- 								<div class="error-message" id="editDiaChiError"></div> -->
<!-- 							</div> -->

<!-- 							<div class="mb-3"> -->
<!-- 								<label for="editSoDienThoai" class="form-label">Số Điện -->
<!-- 									Thoại</label> <input type="text" class="form-control" -->
<!-- 									id="editSoDienThoai" th:value="${taiKhoanAdmin.soDienThoai}"> -->
<!-- 								<div class="error-message" id="editSoDienThoaiError"></div> -->
<!-- 							</div> -->

<!-- 							<div class="mb-3"> -->
<!-- 								<label for="editEmail" class="form-label">Email</label> <input -->
<!-- 									type="email" class="form-control" id="editEmail" -->
<!-- 									th:value="${taiKhoanAdmin.email}"> -->
<!-- 								<div class="error-message" id="editEmailError"></div> -->
<!-- 							</div> -->
						
<!--                 </div> -->
<!--                 <div class="modal-footer"> -->
<!--                     <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button> -->
<!--                     <button type="button" class="btn btn-primary saveEditAccount">Lưu</button> -->
<!--                 </div> -->
<!--             </div> -->
<!--         </div> -->
<!--     </div> -->
<!-- </div> -->
	
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script th:inline="javascript">
    // Your existing JavaScript code
    $(document).on('click', '.lock-account', function (e) {
        e.preventDefault();
        accountIdToLock = $(this).data('account-id');
        var modalSelector = '#confirmationModal-' + accountIdToLock;
        $(modalSelector).modal('show');
    });

    $(document).on('click', '.confirmLock', function () {
        var accountIdToLock = $(this).data('account-id');
        var modalSelector = '#confirmationModal-' + accountIdToLock;
        $(modalSelector).modal('hide');

        // Send an AJAX request to the server to lock the account
        $.ajax({
            type: 'POST',
            url: '/admin/lockAccountAdmin',
            data: {accountId: accountIdToLock},
            success: function (response) {
                if (response === 'success') {
                    // Update the UI or perform any other action
                    reloadDataTableContent();
                } else {
                    alert('Failed to lock account. Please try again.');
                }
            },
            error: function () {
                alert('Error occurred while processing the request.');
            }
        });
    });

    function reloadDataTableContent() {
        // Fetch and update the table content dynamically
        $.get('/admin/listAccountAdmin', function (data) {
            // Replace the existing table content with the updated content
            $('#datatable-container').html($(data).find('#datatable-container').html());
        });
    }
 // Your existing JavaScript code
    
	
	$(document).ready(function() {
		$(document).on('click', '.edit-account', function(e) {
			e.preventDefault();
			var accountIdToEdit = $(this).data('account-id');
			var modalSelector = '#editAccountModal-' + accountIdToEdit;
			$(modalSelector).modal('show');
		});

	});
	function displayError(inputId, errorMessage) {
		var errorContainer = $('#' + inputId + 'Error');
		errorContainer.text(errorMessage);
		errorContainer.show(); // Show the error message
	}

	function clearErrors() {
		$('.error-message').hide(); // Hide all error messages
	}

	$(document).on('click', '.lock-account', function(e) {
		e.preventDefault();
		accountIdToLock = $(this).data('account-id');
		var modalSelector = '#confirmationModal-' + accountIdToLock;
		$(modalSelector).modal('show');
	});

	$(document).on('click', '.confirmLock', function() {
		var accountIdToLock = $(this).data('account-id');
		var modalSelector = '#confirmationModal-' + accountIdToLock;
		$(modalSelector).modal('hide');

		// Send an AJAX request to the server to lock the account
		$.ajax({
			type : 'POST',
			url : '/admin/lockAccountAdmin',
			data : {
				accountId : accountIdToLock
			},
			success : function(response) {
				if (response === 'success') {
					// Update the UI or perform any other action
					reloadDataTableContent();
				} else {
					alert('Failed to lock account. Please try again.');
				}
			},
			error : function() {
				alert('Error occurred while processing the request.');
			}
		});
	});

	function reloadDataTableContent() {
		// Fetch and update the table content dynamically
		$.get('/admin/listAccountAdmin', function(data) {
			// Replace the existing table content with the updated content
			$('#datatable-container').html(
					$(data).find('#datatable-container').html());
		});
	}

	//     $(document).ready(function () {
	//         $(document).on('click', '.edit-account', function (e) {
	//             e.preventDefault();
	//             var accountIdToEdit = $(this).data('account-id');
	//             var modalSelector = '#editAccountModal-' + accountIdToEdit;

	//             // Lấy dữ liệu từ CSDL và thiết lập giá trị mặc định cho các input
	// //             var hoTen = /* Lấy dữ liệu từ CSDL */;
	// //             var diaChi = /* Lấy dữ liệu từ CSDL */;
	// //             var soDienThoai = /* Lấy dữ liệu từ CSDL */;
	// //             var email = /* Lấy dữ liệu từ CSDL */;

	//             $(modalSelector + ' #editHoTen').val(hoTen);
	//             $(modalSelector + ' #editDiaChi').val(diaChi);
	//             $(modalSelector + ' #editSoDienThoai').val(soDienThoai);
	//             $(modalSelector + ' #editEmail').val(email);

	//             $(modalSelector).modal('show');
	//         });

	//         $(document).on('click', '.saveEditAccount', function () {
	//             var accountIdToEdit = $(this).data('account-id');
	//             var modalSelector = '#editAccountModal-' + accountIdToEdit;

	//             var hoTen = $(modalSelector + ' #editHoTen').val().trim();
	//             var diaChi = $(modalSelector + ' #editDiaChi').val().trim();
	//             var soDienThoai = $(modalSelector + ' #editSoDienThoai').val().trim();
	//             var email = $(modalSelector + ' #editEmail').val().trim();

	//             console.log('Giá trị mới sau khi thay đổi:');
	//             console.log('Họ Tên:', hoTen);
	//             console.log('Địa Chỉ:', diaChi);
	//             console.log('Số Điện Thoại:', soDienThoai);
	//             console.log('Email:', email);

	//             // Thực hiện lưu dữ liệu, ví dụ: sử dụng AJAX
	//             // $.ajax({
	//             //     type: 'POST',
	//             //     url: '/saveEditAccount',
	//             //     data: {
	//             //         accountId: accountIdToEdit,
	//             //         hoTen: hoTen,
	//             //         diaChi: diaChi,
	//             //         soDienThoai: soDienThoai,
	//             //         email: email
	//             //     },
	//             //     success: function (response) {
	//             //         // Xử lý kết quả từ server
	//             //     },
	//             //     error: function () {
	//             //         alert('Lỗi xử lý yêu cầu.');
	//             //     }
	//             // });
	//         });
	//     });
</script>


</body>

</html>