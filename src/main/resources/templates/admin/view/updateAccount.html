<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/admin/layout/layout :: content(~{::body},~{::title})}">
<head>
<title>Trang chủ</title>
<body>
	<!-- Page Content-->
	<div class="page-content">
		<div class="container-fluid">
			<!-- Page-Title -->
			<div class="row">
				<div class="col-sm-12">
					<div class="page-title-box">
						
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Cập nhật tài khoản quản lý</h4>
                                    <p class="text-muted mb-0">Tính năng cập nhật tài khoản quản lý</p>
                                </div><!--end card-header-->
                                <div class="card-body">

										
										

  	<div class="card-body">
  	
  	
                                             <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label for="fullName" class="col-lg-3 col-form-label">Họ tên</label>
                                <div class="col-lg-9">
                                    <input id="fullName" th:value="${tkedit?.hoTen}" name="fullName" type="text" class="form-control" required>
                                    <div class="error-message" id="fullName-error" style="color: red;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label for="phoneNumber" class="col-lg-3 col-form-label">Số điện thoại</label>
                                <div class="col-lg-9">
                                    <input id="phoneNumber" th:value="${tkedit?.soDienThoai}" name="phoneNumber" type="text" class="form-control" required>
                                    <div class="error-message" id="phoneNumber-error"style="color: red;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label for="username" class="col-lg-3 col-form-label">Tên tài khoản</label>
                                <div class="col-lg-9">
                                    <input id="username" th:value="${tkedit?.tenDangNhap}" name="username" type="text" class="form-control" required readonly>
                                    <div class="error-message" id="username-error"style="color: red;"></div>
                                </div>
                            </div>
                        </div>

<div class="col-md-6">
                            <div class="form-group row">
                                <label for="email" class="col-lg-3 col-form-label">Email</label>
                                <div class="col-lg-9">
                                    <input id="email" th:value="${tkedit?.email}" name="email" type="text" class="form-control" required>
                                    <div class="error-message" id="email-error"style="color: red;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-6">
                            <div class="form-group row">
                                <label for="address" class="col-lg-3 col-form-label">Địa chỉ</label>
                                <div class="col-lg-9">
                                    <input id="address" th:value="${tkedit?.diaChi}" name="address" type="text" class="form-control" required>
                                    <div class="error-message" id="address-error"style="color: red;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                                            
                                             <div class="row">

												<div class="col-md-6">
													<div class="form-group row">
														<label for="address" class="col-lg-3 col-form-label">Tải
															lên ảnh mới:</label> <input type="file" id="input-file-now"
															class="dropify" accept=".jpg, .jpeg, .png" /> 
														<center>
															<div class="error-message" id="image-error"
																style="color: red;"></div>
														</center>
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group row">
														<label for="address" class="col-lg-3 col-form-label">Ảnh cũ:</label> 
														<img th:src="@{'/images/avatar/' +${tkedit?.hinhAnh}}" alt="" style="max-width: 300px; max-height: 300px">
														
													</div>
												</div>


											</div>
                                            
                                        
  	 <button type="button" id="nextButton" class="btn btn-primary">Cập nhật</button>
  	</div>
  </div>
  
							<br>			
		</div>
		<!-- container -->
	
		<footer class="footer text-center text-sm-start">
			&copy;
			<script>
				document.write(new Date().getFullYear())
			</script>
			Dastone <span class="text-muted d-none d-sm-inline-block float-end">Crafted
				with <i class="mdi mdi-heart text-danger"></i> by Mannatthemes
			</span>
		</footer>
		<!--end footer-->
	</div>
	<!-- end page content -->
	</div>
	<!-- end page-wrapper -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {

	document.getElementById("nextButton").addEventListener("click", async function() {
	    // Reset previous error messages
	    resetErrorMessages();
	    var hasValidationError = false;
	    var username = document.getElementById("username").value.trim();
	    var email = document.getElementById("email").value.trim();
	    var phoneNumber = document.getElementById("phoneNumber").value.trim();

	    // Validate each input field
	    if (!validateInput("fullName")) {
	        showError("fullName", "Họ tên không được bỏ trống");
	        hasValidationError = true;
	    }

	    if (!validateInput("phoneNumber")) {
	        showError("phoneNumber", "Số điện thoại không được bỏ trống");
	        hasValidationError = true;
	    } else if (!validatePhoneNumber("phoneNumber")) {
	        showError("phoneNumber", "Số điện thoại phải có 10 số");
	        hasValidationError = true;
	    }

	    if (!validateInput("username")) {
	        showError("username", "Tên tài khoản không được bỏ trống");
	        hasValidationError = true;
	    } else if (!validateUsernameLength("username")) {
	        showError("username", "Tên tài khoản phải có ít nhất 6 ký tự");
	        hasValidationError = true;
	    }

	    if (!validateInput("email")) {
	        showError("email", "Email không được bỏ trống");
	        hasValidationError = true;
	    } else if (!validateEmail("email")) {
	        showError("email", "Email không hợp lệ '...@gmail.com'");
	        hasValidationError = true;
	    }

	    if (!validateInput("address")) {
	        showError("address", "Địa chỉ không được bỏ trống");
	        hasValidationError = true;
	    }


        
	    var inputFile = document.getElementById("input-file-now").files[0];

	 // Reset image error message
	 var errorDiv = document.getElementById("image-error");
	 if (errorDiv) {
	     errorDiv.innerHTML = "";
	 }

	 if (inputFile) {
	     var maxImageSize = 4000000; // 4MB
	     var maxImageWidth = 1500;
	     var maxImageHeight = 1500;

	     // Check file size
	     if (inputFile.size > maxImageSize) {
	         var errorMessage = "Dung lượng ảnh quá lớn. Vui lòng chọn ảnh có dung lượng nhỏ hơn 4MB.";
	         if (errorDiv) {
	             errorDiv.innerHTML = errorMessage;
	         }
	         hasValidationError = true;
	     } else {
	         var image = new Image();
	         image.src = URL.createObjectURL(inputFile);

	         // Wrap the image loading in a Promise
	         await new Promise((resolve, reject) => {
	             image.onload = resolve;
	             image.onerror = reject;
	         });

	         // Use setTimeout to wait for the event loop to clear before checking dimensions
	         await new Promise(resolve => setTimeout(resolve, 0));

	         // Check image dimensions
	         if (image.width > maxImageWidth || image.height > maxImageHeight) {
	             var errorMessage = "Kích thước ảnh quá lớn. Vui lòng chọn ảnh có kích thước nhỏ hơn.";
	             if (errorDiv) {
	                 errorDiv.innerHTML = errorMessage;
	             }
	             hasValidationError = true;
	         }
	     }
	 }


        

	    try {
	        

	        // Check email existence
	        const emailResponse = await fetch(`/check-emailedit?email=${encodeURIComponent(email)}&username=${encodeURIComponent(username)}`);
	        const emailData = await emailResponse.json();
	        if (emailData.isEmailExists) {
	            showError("email", "Email đã tồn tại.");
	            hasValidationError = true;
	        }

	        // Check phone number existence
	        const phoneNumberResponse = await fetch(`/check-phone-numberedit?phoneNumber=${encodeURIComponent(phoneNumber)}&username=${encodeURIComponent(username)}`);
	        const phoneNumberData = await phoneNumberResponse.json();
	        if (phoneNumberData.isPhoneNumberExists) {
	            showError("phoneNumber", "Số điện thoại đã tồn tại.");
	            hasValidationError = true;
	        }
	    } catch (error) {
	        console.error("Error in validation:", error);
	        hasValidationError = true;
	    }

	    if (!hasValidationError) {
	        sendDataToBackend();
	        resetInputFields()
	    }
	    function showError(inputId, errorMessage) {

            var errorElement = document.getElementById(inputId + "-error");
            if (errorElement) {
                hasValidationError = true;
                errorElement.innerHTML = errorMessage;
            }
        }
	});

	
    
    
    function resetErrorMessages() {
        // Reset error messages
        var errorMessages = document.getElementsByClassName("error-message");
        for (var i = 0; i < errorMessages.length; i++) {
            errorMessages[i].innerHTML = "";
        }
    }

    
    
    function validateInput(inputId) {
        // Validate input and return true if valid, false if invalid
        var inputValue = document.getElementById(inputId).value.trim();
        hasValidationError = true;
        return inputValue !== "";
    }

    function showError(inputId, errorMessage) {
        // Display error message for the specified input
        var errorElement = document.getElementById(inputId + "-error");
        if (errorElement) {
        	hasValidationError = true;
            errorElement.innerHTML = errorMessage;
        }
    }

    function isFormValid() {
        // Check if all input fields are valid
        var inputs = document.querySelectorAll("input[required]");
        for (var i = 0; i < inputs.length; i++) {
            if (!validateInput(inputs[i].id)) {
            	hasValidationError = true;
                return false;
            }
        }
        return true;
    }
    function validatePhoneNumber(inputId) {
        // Validate phone number (10 digits)
        var phoneNumber = document.getElementById(inputId).value.trim();
        hasValidationError = true;
        return /^\d{10}$/.test(phoneNumber);
    }

    function validateEmail(inputId) {
        // Validate email format
        var email = document.getElementById(inputId).value.trim();
        // You can use a more sophisticated email validation regex if needed
        hasValidationError = true;
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    function validateUsernameLength(inputId) {
        // Validate username length (at least 6 characters)
        var username = document.getElementById(inputId).value.trim();
        hasValidationError = true;
        return username.length >= 6;
    }
   
    
    function sendDataToBackend() {
        // Create a FormData object to append form data
        var formData = new FormData();
        formData.append("fullName", document.getElementById("fullName").value.trim());
        formData.append("phoneNumber", document.getElementById("phoneNumber").value.trim());
        formData.append("username", document.getElementById("username").value.trim());
        formData.append("email", document.getElementById("email").value.trim());
        formData.append("address", document.getElementById("address").value.trim());

        // Append the uploaded file to FormData
        var inputFile = document.getElementById("input-file-now").files[0];
        if (inputFile) {
            formData.append("file", inputFile);
        }

        // Perform the AJAX request or use the Fetch API to send data to the backend
        fetch("/editAdmin-form", {
            method: "POST",
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // Redirect to the listAccountAdmin page after successful form submission
                window.location.href = "/admin/listAccountAdmin";
            }
            return response.json();
        })
        .then(data => {
            // Handle the response from the backend (if needed)
            console.log(data);
        })
        .catch(error => {
            console.error("Error:", error);
        });
    }
    function resetInputFields() {
        // Reset all input fields
        var inputs = document.querySelectorAll("input");
        inputs.forEach(input => {
            input.value = "";
        });

        // Reset the file input (if any)
        var fileInput = document.getElementById("input-file-now");
        if (fileInput) {
            fileInput.value = "";
        }
        var removeButton = document.querySelector(".dropify-clear");
        if (removeButton) {
            removeButton.click();
        }
    }
});
</script>




</body>
<!-- Mirrored from mannatthemes.com/dastone/default/forms-elements.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 06 Nov 2023 06:54:37 GMT -->
</html>